<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è®¾å¤‡åˆ†ç»„ - é‡‘åç†å·¥ç‰©è”ç½‘å¹³å°</title>
    <link rel="stylesheet" href="styles.css">
</head>

<body>
    <div class="app-container">
        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="brand">
                <div class="brand-logo"></div>
                <div class="brand-text">ç‰©è”ç½‘å¹³å°</div>
            </div>
            <nav class="nav-menu">
                <div class="nav-group-title">è®¾å¤‡ç©ºé—´ç®¡ç†</div>
                <a href="101_åŸºç¡€è®¾å¤‡ç›®å½•ç®¡ç†.html" class="nav-item">
                    <span>ğŸ“š</span> åŸºç¡€ç›®å½•
                </a>
                <a href="101_æ ‡ç­¾ç®¡ç†.html" class="nav-item">
                    <span>ğŸ·ï¸</span> æ ‡ç­¾ç®¡ç†
                </a>
                <a href="101_åœ°å›¾å¹¿åœº.html" class="nav-item">
                    <span>ğŸ—ºï¸</span> åœ°å›¾å¹¿åœº
                </a>
                <a href="101_åœ°å›¾ç®¡ç†.html" class="nav-item">
                    <span>âš™ï¸</span> åœ°å›¾é…ç½®
                </a>

                <div class="nav-group-title">è®¾å¤‡æ²»ç†</div>
                <a href="102_æ²»ç†ä»»åŠ¡.html" class="nav-item">
                    <span>ğŸ“‹</span> æ²»ç†ä»»åŠ¡
                </a>
                <a href="102_æ²»ç†å‚æ•°è®¾ç½®.html" class="nav-item">
                    <span>âš™ï¸</span> å‚æ•°è®¾ç½®
                </a>

                <div class="nav-group-title">ç‰©è”ç½‘è®¾å¤‡ç®¡ç†</div>
                <a href="103_å¹³å°è®¾å¤‡ç®¡ç†.html" class="nav-item">
                    <span>ğŸ–¥ï¸</span> å¹³å°ç®¡ç†
                </a>
                <a href="103_å¹³å°é€šé“ç®¡ç†.html" class="nav-item">
                    <span>ğŸ“¡</span> é€šé“ç®¡ç†
                </a>
                <a href="103_è®¾å¤‡åˆ†ç»„ç®¡ç†.html" class="nav-item active">
                    <span>ğŸ“‚</span> è®¾å¤‡åˆ†ç»„
                </a>

                <div class="nav-group-title">è§†é¢‘æƒé™ç®¡ç†</div>
                <a href="104_ç›´æ¥å…±äº«.html" class="nav-item">
                    <span>ğŸ“±</span> ç›´æ¥å…±äº«
                </a>
                <!-- <span>ğŸ¨</span> åº”ç”¨ç¼–æ’ (Coming Soon) -->
                <a href="104_ä»£ç†å…±äº«.html" class="nav-item">
                    <span>ğŸ”—</span> ä»£ç†å…±äº«
                </a>

                <div class="nav-group-title">æƒé™å®¡æ‰¹ç®¡ç†</div>
                <a href="105_éœ€æ±‚ç™»è®°.html" class="nav-item">
                    <span>ğŸ“</span> éœ€æ±‚ç™»è®°
                </a>
                <a href="105_éœ€æ±‚å®¡æ‰¹.html" class="nav-item">
                    <span>âš–ï¸</span> éœ€æ±‚å®¡æ‰¹
                </a>
                <a href="105_æˆæƒç®¡ç†.html" class="nav-item">
                    <span>ğŸ›‘</span> æˆæƒç®¡ç†
                </a>
            </nav>
        </aside>

        <!-- Main Content -->
        <div class="main-content">
            <header class="top-bar">
                <h2 class="page-title">è®¾å¤‡åˆ†ç»„</h2>
                <div class="user-profile">
                    <span>ç®¡ç†å‘˜</span>
                    <div class="avatar"></div>
                </div>
            </header>

            <div class="content-area">
                <!-- Group List View -->
                <div id="groupListView">
                    <!-- Filters -->
                    <div class="filter-bar">
                        <div style="flex: 1; min-width: 200px;">
                            <label class="input-label">åˆ†ç»„ID</label>
                            <input type="text" class="glass-input" placeholder="ç²¾ç¡®æœç´¢">
                        </div>
                        <div style="flex: 1; min-width: 200px;">
                            <label class="input-label">åˆ†ç»„åç§°</label>
                            <input type="text" class="glass-input" placeholder="æ¨¡ç³Šæœç´¢">
                        </div>
                        <div style="display: flex; align-items: flex-end; gap: 8px;">
                            <button class="btn btn-primary" onclick="searchData()">æŸ¥è¯¢</button>
                            <button class="btn btn-secondary" onclick="resetSearch()">é‡ç½®</button>
                        </div>
                        <div style="flex: 1; display: flex; justify-content: flex-end; align-items: flex-end;">
                            <button class="btn btn-primary" onclick="openGroupModal()">+ æ–°å¢åˆ†ç»„</button>
                        </div>
                    </div>

                    <!-- Group List -->
                    <div class="glass-panel">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>åˆ†ç»„ID</th>
                                    <th>åˆ†ç»„åç§°</th>
                                    <th>è®¾å¤‡æ•°é‡</th>
                                    <th>è¯´æ˜</th>
                                    <th>åˆ›å»ºæ—¶é—´</th>
                                    <th>æ“ä½œ</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>1001</td>
                                    <td>é‡ç‚¹ç›‘æ§é€šé“</td>
                                    <td>35</td>
                                    <td>æ ¡åŒºä¸»å‡ºå…¥å£åŠå‘¨ç•Œ</td>
                                    <td>2025-10-10 09:00:00</td>
                                    <td>
                                        <button class="btn btn-secondary" style="padding: 4px 8px; font-size: 12px;"
                                            onclick="showGroupDetail(1001, 'é‡ç‚¹ç›‘æ§é€šé“')">è¯¦æƒ…</button>
                                        <button class="btn btn-secondary" style="padding: 4px 8px; font-size: 12px;"
                                            onclick="openGroupModal(true)">ç¼–è¾‘</button>
                                        <button class="btn btn-secondary"
                                            style="padding: 4px 8px; font-size: 12px; color: var(--danger); border-color: var(--danger);"
                                            onclick="deleteGroup()">åˆ é™¤</button>
                                    </td>
                                </tr>
                                <tr>
                                    <td>1002</td>
                                    <td>é«˜ç©ºæŠ›ç‰©è®¾å¤‡</td>
                                    <td>12</td>
                                    <td>å®¿èˆæ¥¼å¤–ç«‹é¢ç›‘æ§</td>
                                    <td>2025-10-12 14:30:00</td>
                                    <td>
                                        <button class="btn btn-secondary" style="padding: 4px 8px; font-size: 12px;"
                                            onclick="showGroupDetail(1002, 'é«˜ç©ºæŠ›ç‰©è®¾å¤‡')">è¯¦æƒ…</button>
                                        <button class="btn btn-secondary" style="padding: 4px 8px; font-size: 12px;"
                                            onclick="openGroupModal(true)">ç¼–è¾‘</button>
                                        <button class="btn btn-secondary"
                                            style="padding: 4px 8px; font-size: 12px; color: var(--danger); border-color: var(--danger);"
                                            onclick="deleteGroup()">åˆ é™¤</button>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Group Detail View (Hidden by default) -->
                <div id="groupDetailView" style="display: none;">
                    <!-- Detail Header -->
                    <div style="margin-bottom: 16px; display: flex; align-items: center; gap: 16px;">
                        <button class="btn btn-secondary" onclick="hideGroupDetail()">â† è¿”å›</button>
                        <h3 style="margin: 0;">åˆ†ç»„è¯¦æƒ…: <span id="detailGroupName">é‡ç‚¹ç›‘æ§é€šé“</span></h3>
                        <div class="status-tag status-success" style="font-size: 12px;">ID: <span
                                id="detailGroupId">1001</span></div>
                    </div>

                    <!-- Info Overview -->
                    <div style="display: flex; gap: 16px; margin-bottom: 16px;">
                        <div class="glass-panel"
                            style="flex: 1; padding: 16px; display: flex; align-items: center; justify-content: space-between;">
                            <div>
                                <div style="color: #666; font-size: 12px;">è®¾å¤‡æ€»æ•°</div>
                                <div style="font-size: 24px; font-weight: bold;">35</div>
                            </div>
                            <div style="font-size: 24px;">ğŸ“¦</div>
                        </div>
                        <div class="glass-panel"
                            style="flex: 1; padding: 16px; display: flex; align-items: center; justify-content: space-between;">
                            <div>
                                <div style="color: #666; font-size: 12px;">åœ¨çº¿è®¾å¤‡</div>
                                <div style="font-size: 24px; font-weight: bold; color: var(--success);">32</div>
                            </div>
                            <div style="font-size: 24px;">ğŸŸ¢</div>
                        </div>
                        <div class="glass-panel" style="flex: 2;"></div>
                    </div>

                    <!-- Device List in Group -->
                    <div class="glass-panel">
                        <div class="filter-bar"
                            style="border-bottom: 1px solid #eee; margin-bottom: 0; padding-bottom: 16px;">
                            <div style="flex: 1; min-width: 150px;">
                                <label class="input-label">è®¾å¤‡åç§°</label>
                                <input type="text" class="glass-input" placeholder="æ¨¡ç³Šæœç´¢">
                            </div>
                            <div style="flex: 1; min-width: 150px;">
                                <label class="input-label">äº§å“åç§°</label>
                                <input type="text" class="glass-input" placeholder="æ¨¡ç³Šæœç´¢">
                            </div>
                            <div style="display: flex; align-items: flex-end; gap: 8px;">
                                <button class="btn btn-primary" onclick="searchData()">æŸ¥è¯¢</button>
                                <button class="btn btn-secondary" onclick="resetSearch()">é‡ç½®</button>
                            </div>
                        </div>

                        <div style="padding: 12px; display: flex; gap: 8px;">
                            <button class="btn btn-primary" onclick="openAddDeviceModal()">+ åŠ å…¥è®¾å¤‡</button>
                            <button class="btn btn-secondary" style="color: var(--danger); border-color: var(--danger);"
                                onclick="batchRemoveDevices()">æ‰¹é‡ç§»é™¤</button>
                        </div>

                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th style="width: 40px;"><input type="checkbox"></th>
                                    <th>è®¾å¤‡ID</th>
                                    <th>è®¾å¤‡åç§°</th>
                                    <th>äº§å“åç§°</th>
                                    <th>çŠ¶æ€</th>
                                    <th>æ“ä½œ</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td><input type="checkbox"></td>
                                    <td>DEV_001</td>
                                    <td>å—é—¨æŠ“æ‹æœº01</td>
                                    <td>æµ·åº·å¨è§†IPC</td>
                                    <td><span class="status-tag status-success">åœ¨çº¿</span></td>
                                    <td>
                                        <button class="btn btn-secondary"
                                            style="padding: 4px 8px; font-size: 12px; color: var(--danger); border-color: var(--danger);"
                                            onclick="removeDevice()">ç§»é™¤</button>
                                    </td>
                                </tr>
                                <tr>
                                    <td><input type="checkbox"></td>
                                    <td>DEV_002</td>
                                    <td>å—é—¨æŠ“æ‹æœº02</td>
                                    <td>æµ·åº·å¨è§†IPC</td>
                                    <td><span class="status-tag status-warning">ç¦»çº¿</span></td>
                                    <td>
                                        <button class="btn btn-secondary"
                                            style="padding: 4px 8px; font-size: 12px; color: var(--danger); border-color: var(--danger);"
                                            onclick="removeDevice()">ç§»é™¤</button>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Add/Edit Group Modal -->
    <div class="modal-overlay" id="groupModal">
        <div class="modal-content" style="width: 500px;">
            <div class="modal-header">
                <h3 class="modal-title" id="groupModalTitle">æ–°å¢åˆ†ç»„</h3>
                <button class="modal-close" onclick="closeGroupModal()">Ã—</button>
            </div>
            <div class="modal-body">
                <div class="input-group">
                    <label class="input-label"><span style="color:red">*</span> åˆ†ç»„åç§°</label>
                    <input type="text" class="glass-input" placeholder="è¯·è¾“å…¥åˆ†ç»„åç§°ï¼ˆä¸å¯é‡å¤ï¼‰">
                </div>
                <div class="input-group">
                    <label class="input-label">è¯´æ˜</label>
                    <textarea class="glass-input" rows="4" placeholder="è¯·è¾“å…¥å¤‡æ³¨ä¿¡æ¯"></textarea>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeGroupModal()">å–æ¶ˆ</button>
                <button class="btn btn-primary" onclick="saveGroup()">ç¡®å®š</button>
            </div>
        </div>
    </div>

    <!-- Add Device Modal -->
    <div class="modal-overlay" id="addDeviceModal">
        <div class="modal-content" style="width: 800px; max-width: 90vw;">
            <div class="modal-header">
                <h3 class="modal-title">åŠ å…¥è®¾å¤‡</h3>
                <button class="modal-close" onclick="closeAddDeviceModal()">Ã—</button>
            </div>
            <div class="modal-body" style="display: flex; gap: 16px; height: 500px;">
                <!-- Left: Device Selection -->
                <div
                    style="flex: 1; display: flex; flex-direction: column; border: 1px solid #eee; border-radius: 4px;">
                    <div style="padding: 12px; border-bottom: 1px solid #eee; background: #f8fafc;">
                        <div style="display: flex; gap: 8px; margin-bottom: 8px;">
                            <select class="glass-input" style="flex: 1;">
                                <option>æ‰€æœ‰äº§å“</option>
                                <option>æµ·åº·å¨è§†IPC</option>
                                <option>å¤§åé—¨ç¦</option>
                            </select>
                        </div>
                        <input type="text" class="glass-input" placeholder="æœç´¢è®¾å¤‡åç§°" style="width: 100%;">
                    </div>
                    <div style="flex: 1; overflow-y: auto; padding: 8px;">
                        <!-- Mock Device List -->
                        <div class="device-item" onclick="toggleDeviceSelection(this, 'DEV_003', 'ä¸œé—¨äººè„¸æœº01')"
                            style="padding: 8px; border-bottom: 1px solid #eee; cursor: pointer; display: flex; align-items: center; gap: 8px;">
                            <input type="checkbox" style="pointer-events: none;">
                            <div>
                                <div style="font-weight: bold; font-size: 14px;">ä¸œé—¨äººè„¸æœº01</div>
                                <div style="font-size: 12px; color: #666;">å¤§åé—¨ç¦ | DEV_003</div>
                            </div>
                        </div>
                        <div class="device-item" onclick="toggleDeviceSelection(this, 'DEV_004', 'ä¸œé—¨äººè„¸æœº02')"
                            style="padding: 8px; border-bottom: 1px solid #eee; cursor: pointer; display: flex; align-items: center; gap: 8px;">
                            <input type="checkbox" style="pointer-events: none;">
                            <div>
                                <div style="font-weight: bold; font-size: 14px;">ä¸œé—¨äººè„¸æœº02</div>
                                <div style="font-size: 12px; color: #666;">å¤§åé—¨ç¦ | DEV_004</div>
                            </div>
                        </div>
                        <div class="device-item" onclick="toggleDeviceSelection(this, 'DEV_005', 'è¥¿é—¨é“é—¸')"
                            style="padding: 8px; border-bottom: 1px solid #eee; cursor: pointer; display: flex; align-items: center; gap: 8px;">
                            <input type="checkbox" style="pointer-events: none;">
                            <div>
                                <div style="font-weight: bold; font-size: 14px;">è¥¿é—¨é“é—¸</div>
                                <div style="font-size: 12px; color: #666;">æ·é¡ºé“é—¸ | DEV_005</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Right: Selected Devices -->
                <div
                    style="flex: 1; display: flex; flex-direction: column; border: 1px solid #eee; border-radius: 4px;">
                    <div
                        style="padding: 12px; border-bottom: 1px solid #eee; background: #f8fafc; display: flex; justify-content: space-between; align-items: center;">
                        <span style="font-weight: bold;">å·²é€‰è®¾å¤‡ (<span id="selectedCount">0</span>)</span>
                        <button class="btn btn-secondary" style="padding: 2px 6px; font-size: 12px;"
                            onclick="clearSelection()">æ¸…ç©º</button>
                    </div>
                    <div id="selectedDeviceList" style="flex: 1; overflow-y: auto; padding: 8px;">
                        <!-- Selected items will be added here -->
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeAddDeviceModal()">å–æ¶ˆ</button>
                <button class="btn btn-primary" onclick="saveAddedDevices()">ç¡®å®š</button>
            </div>
        </div>
    </div>

    <script src="script.js"></script>
    <script>
        // --- Global Search/Reset ---
        function searchData() {
            showToast('æ•°æ®å·²åˆ·æ–°');
        }

        function resetSearch() {
            const inputs = document.querySelectorAll('.filter-bar input');
            inputs.forEach(input => input.value = '');
            showToast('æœç´¢æ¡ä»¶å·²é‡ç½®');
        }

        // --- Group Modal ---
        function openGroupModal(isEdit = false) {
            document.getElementById('groupModalTitle').innerText = isEdit ? 'ç¼–è¾‘åˆ†ç»„' : 'æ–°å¢åˆ†ç»„';
            document.getElementById('groupModal').classList.add('active');
        }

        function closeGroupModal() {
            document.getElementById('groupModal').classList.remove('active');
        }

        function saveGroup() {
            closeGroupModal();
            showToast('åˆ†ç»„ä¿¡æ¯ä¿å­˜æˆåŠŸ', 'success');
        }

        function deleteGroup() {
            // Logic: if associated devices > 0, prevent delete
            // For demo, we assume ID 1001 has devices
            const hasDevices = Math.random() > 0.5;

            if (hasDevices) {
                showToast('è¯¥åˆ†ç»„ä¸‹å­˜åœ¨å…³è”è®¾å¤‡ï¼Œè¯·å…ˆç§»é™¤è®¾å¤‡', 'error');
            } else {
                showConfirm('ç¡®å®šè¦åˆ é™¤è¯¥åˆ†ç»„å—ï¼Ÿ', () => {
                    showToast('åˆ†ç»„å·²åˆ é™¤', 'success');
                });
            }
        }

        // --- Detail View ---
        function showGroupDetail(id, name) {
            document.getElementById('groupListView').style.display = 'none';
            document.getElementById('groupDetailView').style.display = 'block';
            document.getElementById('detailGroupId').innerText = id;
            document.getElementById('detailGroupName').innerText = name;
        }

        function hideGroupDetail() {
            document.getElementById('groupDetailView').style.display = 'none';
            document.getElementById('groupListView').style.display = 'block';
        }

        function removeDevice() {
            showConfirm('ç¡®å®šè¦ä»åˆ†ç»„ä¸­ç§»é™¤è¯¥è®¾å¤‡å—ï¼Ÿ', () => {
                showToast('è®¾å¤‡å·²ç§»é™¤', 'success');
            });
        }

        function batchRemoveDevices() {
            showConfirm('ç¡®å®šè¦æ‰¹é‡ç§»é™¤é€‰ä¸­çš„è®¾å¤‡å—ï¼Ÿ', () => {
                showToast('å·²æ‰¹é‡ç§»é™¤è®¾å¤‡', 'success');
            });
        }

        // --- Add Device Modal ---
        function openAddDeviceModal() {
            document.getElementById('addDeviceModal').classList.add('active');
            clearSelection(); // Reset selection when opening
        }

        function closeAddDeviceModal() {
            document.getElementById('addDeviceModal').classList.remove('active');
        }

        let selectedDevices = new Set();

        function toggleDeviceSelection(el, id, name) {
            const checkbox = el.querySelector('input[type="checkbox"]');

            if (selectedDevices.has(id)) {
                selectedDevices.delete(id);
                checkbox.checked = false;
                el.style.background = 'transparent';
                removeSelectedTag(id);
            } else {
                selectedDevices.add(id);
                checkbox.checked = true;
                el.style.background = '#e6f7ff';
                addSelectedTag(id, name);
            }
            updateSelectedCount();
        }

        function addSelectedTag(id, name) {
            const container = document.getElementById('selectedDeviceList');
            const div = document.createElement('div');
            div.id = `tag-${id}`;
            div.style = 'background: #f0f0f0; padding: 6px 10px; border-radius: 4px; margin-bottom: 4px; display: flex; justify-content: space-between; align-items: center;';
            div.innerHTML = `
                <span style="font-size: 13px;">${name}</span>
                <span style="cursor: pointer; color: #999;" onclick="removeSelectionFromRight('${id}')">Ã—</span>
            `;
            container.appendChild(div);
        }

        function removeSelectedTag(id) {
            const el = document.getElementById(`tag-${id}`);
            if (el) el.remove();
        }

        function removeSelectionFromRight(id) {
            // Find left item and uncheck
            // This is a simplified mock. In real app, we'd map IDs to DOM elements better.
            // For now, just remove from set and update UI manually if possible or just clear set logic
            selectedDevices.delete(id);
            removeSelectedTag(id);

            // Try to uncheck left side if visible
            const items = document.querySelectorAll('.device-item');
            items.forEach(item => {
                if (item.getAttribute('onclick').includes(id)) {
                    item.querySelector('input').checked = false;
                    item.style.background = 'transparent';
                }
            });
            updateSelectedCount();
        }

        function clearSelection() {
            selectedDevices.clear();
            document.getElementById('selectedDeviceList').innerHTML = '';
            document.getElementById('selectedCount').innerText = '0';
            const items = document.querySelectorAll('.device-item');
            items.forEach(item => {
                item.querySelector('input').checked = false;
                item.style.background = 'transparent';
            });
        }

        function updateSelectedCount() {
            document.getElementById('selectedCount').innerText = selectedDevices.size;
        }

        function saveAddedDevices() {
            if (selectedDevices.size === 0) {
                showToast('è¯·å…ˆé€‰æ‹©è®¾å¤‡', 'warning');
                return;
            }
            closeAddDeviceModal();
            showToast(`å·²æˆåŠŸåŠ å…¥ ${selectedDevices.size} ä¸ªè®¾å¤‡`, 'success');
        }
    </script>
</body>

</html>