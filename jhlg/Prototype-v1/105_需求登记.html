<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>éœ€æ±‚ç™»è®° - é‡‘åç†å·¥ç‰©è”ç½‘å¹³å°</title>
    <link rel="stylesheet" href="styles.css">
</head>

<body>
    <div class="app-container">
        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="brand">
                <div class="brand-logo"></div>
                <div class="brand-text">ç‰©è”ç½‘å¹³å°</div>
            </div>
            <nav class="nav-menu">
                <div class="nav-group-title">è®¾å¤‡ç©ºé—´ç®¡ç†</div>
                <a href="101_åŸºç¡€è®¾å¤‡ç›®å½•ç®¡ç†.html" class="nav-item">
                    <span>ğŸ“š</span> åŸºç¡€ç›®å½•
                </a>
                <a href="101_æ ‡ç­¾ç®¡ç†.html" class="nav-item">
                    <span>ğŸ·ï¸</span> æ ‡ç­¾ç®¡ç†
                </a>
                <a href="101_åœ°å›¾å¹¿åœº.html" class="nav-item">
                    <span>ğŸ—ºï¸</span> åœ°å›¾å¹¿åœº
                </a>
                <a href="101_åœ°å›¾ç®¡ç†.html" class="nav-item">
                    <span>âš™ï¸</span> åœ°å›¾é…ç½®
                </a>

                <div class="nav-group-title">è®¾å¤‡æ²»ç†</div>
                <a href="102_æ²»ç†ä»»åŠ¡.html" class="nav-item">
                    <span>ğŸ“‹</span> æ²»ç†ä»»åŠ¡
                </a>
                <a href="102_æ²»ç†å‚æ•°è®¾ç½®.html" class="nav-item">
                    <span>âš™ï¸</span> å‚æ•°è®¾ç½®
                </a>

                <div class="nav-group-title">ç‰©è”ç½‘è®¾å¤‡ç®¡ç†</div>
                <a href="103_å¹³å°è®¾å¤‡ç®¡ç†.html" class="nav-item">
                    <span>ğŸ–¥ï¸</span> å¹³å°ç®¡ç†
                </a>
                <a href="103_å¹³å°é€šé“ç®¡ç†.html" class="nav-item">
                    <span>ğŸ“¡</span> é€šé“ç®¡ç†
                </a>
                <a href="103_è®¾å¤‡åˆ†ç»„ç®¡ç†.html" class="nav-item">
                    <span>ğŸ“‚</span> è®¾å¤‡åˆ†ç»„
                </a>

                <div class="nav-group-title">è§†é¢‘æƒé™ç®¡ç†</div>
                <a href="104_ç›´æ¥å…±äº«.html" class="nav-item">
                    <span>ğŸ“±</span> ç›´æ¥å…±äº«
                </a>
                <!-- <span>ğŸ¨</span> åº”ç”¨ç¼–æ’ (Coming Soon) -->
                <a href="104_ä»£ç†å…±äº«.html" class="nav-item">
                    <span>ğŸ”—</span> ä»£ç†å…±äº«
                </a>

                <div class="nav-group-title">æƒé™å®¡æ‰¹ç®¡ç†</div>
                <a href="105_éœ€æ±‚ç™»è®°.html" class="nav-item active">
                    <span>ğŸ“</span> éœ€æ±‚ç™»è®°
                </a>
                <a href="105_éœ€æ±‚å®¡æ‰¹.html" class="nav-item">
                    <span>âš–ï¸</span> éœ€æ±‚å®¡æ‰¹
                </a>
                <a href="105_æˆæƒç®¡ç†.html" class="nav-item">
                    <span>ğŸ›‘</span> æˆæƒç®¡ç†
                </a>
            </nav>
        </aside>

        <!-- Main Content -->
        <div class="main-content">
            <header class="top-bar">
                <h2 class="page-title">éœ€æ±‚ç™»è®°è®°å½•</h2>
                <div class="user-profile">
                    <span>å¼€å‘è€…</span>
                    <div class="avatar"></div>
                </div>
            </header>

            <div class="content-area">
                <!-- Data Filter -->
                <div class="filter-bar">
                    <div style="flex: 1; min-width: 200px;">
                        <label class="input-label">ç”³è¯·å•å·</label>
                        <input type="text" class="glass-input" placeholder="è¯·è¾“å…¥å•å·">
                    </div>
                    <div style="flex: 1; min-width: 160px;">
                        <label class="input-label">ç”³è¯·çŠ¶æ€</label>
                        <select class="glass-input">
                            <option value="">å…¨éƒ¨</option>
                            <option value="pending">å¾…å®¡æ‰¹</option>
                            <option value="approved">å·²é€šè¿‡</option>
                            <option value="rejected">å·²é©³å›</option>
                            <option value="expired">å·²è¿‡æœŸ</option>
                            <option value="withdrawn">å·²æ’¤å›</option>
                        </select>
                    </div>
                    <div style="display: flex; align-items: flex-end; gap: 8px;">
                        <button class="btn btn-primary" onclick="searchData()">æŸ¥è¯¢</button>
                        <button class="btn btn-secondary">é‡ç½®</button>
                    </div>
                    <div style="flex: 1; display: flex; justify-content: flex-end; align-items: flex-end;">
                        <button class="btn btn-primary" onclick="openRequestModal()">+ æ–°å¢éœ€æ±‚</button>
                    </div>
                </div>

                <!-- Request List -->
                <div class="glass-panel">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>ç”³è¯·å•å·</th>
                                <th>å…³è”åº”ç”¨</th>
                                <th>ç”³è¯·æ—¶é—´</th>
                                <th>å½“å‰çŠ¶æ€</th>
                                <th>å®¡æ ¸äºº</th>
                                <th>å®¡æ ¸æ—¶é—´</th>
                                <th>æ“ä½œ</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>REQ202510250001</td>
                                <td>æ™ºæ…§å®‰é˜²åº”ç”¨</td>
                                <td>2025-10-25 10:30</td>
                                <td><span class="status-tag status-warning">å¾…å®¡æ‰¹</span></td>
                                <td>-</td>
                                <td>-</td>
                                <td>
                                    <button class="btn btn-secondary" style="padding: 4px 8px; font-size: 12px;"
                                        onclick="viewDetail()">æŸ¥çœ‹</button>
                                    <button class="btn btn-secondary"
                                        style="padding: 4px 8px; font-size: 12px; color: var(--warning); border-color: var(--warning);"
                                        onclick="withdrawRequest()">æ’¤å›</button>
                                </td>
                            </tr>
                            <tr>
                                <td>REQ202510200005</td>
                                <td>æ¶ˆé˜²é€šé“ç›‘æµ‹</td>
                                <td>2025-10-20 09:15</td>
                                <td><span class="status-tag status-success">å·²é€šè¿‡</span></td>
                                <td>ç®¡ç†å‘˜</td>
                                <td>2025-10-20 14:00</td>
                                <td>
                                    <button class="btn btn-secondary" style="padding: 4px 8px; font-size: 12px;"
                                        onclick="viewDetail()">æŸ¥çœ‹</button>
                                    <button class="btn btn-secondary" style="padding: 4px 8px; font-size: 12px;"
                                        onclick="viewAuth()">æˆæƒ</button>
                                </td>
                            </tr>
                            <tr>
                                <td>REQ202510150002</td>
                                <td>äººè„¸é—¨ç¦æœåŠ¡</td>
                                <td>2025-10-15 16:00</td>
                                <td><span class="status-tag status-danger">å·²é©³å›</span></td>
                                <td>ç®¡ç†å‘˜</td>
                                <td>2025-10-16 09:00</td>
                                <td>
                                    <button class="btn btn-secondary" style="padding: 4px 8px; font-size: 12px;"
                                        onclick="viewDetail()">æŸ¥çœ‹</button>
                                    <button class="btn btn-primary" style="padding: 4px 8px; font-size: 12px;"
                                        onclick="reApply()">é‡æ–°ç”³è¯·</button>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- New Request Modal -->
    <div class="modal-overlay" id="requestModal">
        <div class="modal-content" style="width: 700px;">
            <div class="modal-header">
                <h3 class="modal-title">æ–°å¢éœ€æ±‚ç”³è¯·</h3>
                <button class="modal-close" onclick="closeRequestModal()">Ã—</button>
            </div>
            <div class="modal-body">
                <div class="form-grid" style="display: grid; grid-template-columns: 1fr; gap: 16px;">
                    <div class="input-group">
                        <label class="input-label"><span style="color:red">*</span> å…³è”åº”ç”¨</label>
                        <select class="glass-input">
                            <option value="">è¯·é€‰æ‹©åº”ç”¨</option>
                            <option value="1">æ™ºæ…§å®‰é˜²åº”ç”¨</option>
                            <option value="2">æ¶ˆé˜²é€šé“ç›‘æµ‹</option>
                        </select>
                    </div>

                    <!-- Data Scope Selection -->
                    <div class="input-group"
                        style="padding: 12px; border: 1px dashed #ccc; border-radius: 6px; background: #f8fafc;">
                        <label class="input-label" style="font-weight: 600;"><span style="color:red">*</span>
                            æ•°æ®èŒƒå›´</label>
                        <div style="margin-bottom: 12px;">
                            <label style="margin-right: 16px;">
                                <input type="radio" name="scopeType" onchange="toggleScope('device')" checked> æŒ‰è®¾å¤‡é€‰æ‹©
                            </label>
                            <label>
                                <input type="radio" name="scopeType" onchange="toggleScope('tag')"> æŒ‰æ ‡ç­¾é€‰æ‹©
                            </label>
                        </div>

                        <!-- Device Transfer Panel (Hybrid Mode) -->
                        <div id="deviceScope" style="display: flex; gap: 12px;">
                            <!-- Left Panel: Available Devices -->
                            <div
                                style="flex: 1; background: #fff; border: 1px solid #ddd; border-radius: 6px; display: flex; flex-direction: column;">
                                <div
                                    style="padding: 8px; border-bottom: 1px solid #eee; background: #fafafa; border-radius: 6px 6px 0 0;">
                                    <div style="font-weight: 500; font-size: 13px; margin-bottom: 8px;">å¯é€‰è®¾å¤‡</div>
                                    <input type="text" class="glass-input" placeholder="ğŸ” æœç´¢è®¾å¤‡åç§°/ä½ç½®..."
                                        style="width: 100%; font-size: 12px; padding: 6px 8px;"
                                        oninput="filterDevices(this.value)">
                                    <div style="display: flex; gap: 6px; margin-top: 6px;">
                                        <select class="glass-input" style="flex: 1; font-size: 11px; padding: 4px;">
                                            <option>åŒºåŸŸ: å…¨éƒ¨</option>
                                            <option>æ•™å­¦æ¥¼</option>
                                            <option>å›¾ä¹¦é¦†</option>
                                            <option>è¡Œæ”¿æ¥¼</option>
                                        </select>
                                        <select class="glass-input" style="flex: 1; font-size: 11px; padding: 4px;">
                                            <option>çŠ¶æ€: å…¨éƒ¨</option>
                                            <option>åœ¨çº¿</option>
                                            <option>ç¦»çº¿</option>
                                        </select>
                                    </div>
                                </div>
                                <div style="padding: 4px 8px; border-bottom: 1px solid #f0f0f0; background: #fafafa;">
                                    <label style="font-size: 12px; color: #666;"><input type="checkbox"
                                            onclick="toggleSelectAll(this)"> å…¨é€‰å½“å‰é¡µ</label>
                                </div>
                                <div id="deviceList"
                                    style="flex: 1; overflow-y: auto; max-height: 180px; padding: 4px 0;">
                                    <div class="device-item"
                                        style="display: flex; align-items: center; padding: 6px 10px; border-bottom: 1px solid #f5f5f5; cursor: pointer;"
                                        onclick="toggleDevice(this, 'æ•™å­¦æ¥¼A-å¤§å…å…¨æ™¯')">
                                        <input type="checkbox" style="margin-right: 8px;">
                                        <span style="font-size: 13px;">ğŸ“¹ æ•™å­¦æ¥¼A-å¤§å…å…¨æ™¯</span>
                                        <span style="margin-left: auto; font-size: 10px; color: #52c41a;">â—åœ¨çº¿</span>
                                    </div>
                                    <div class="device-item"
                                        style="display: flex; align-items: center; padding: 6px 10px; border-bottom: 1px solid #f5f5f5; cursor: pointer;"
                                        onclick="toggleDevice(this, 'æ•™å­¦æ¥¼A-ä¸œé—¨çƒæœº')">
                                        <input type="checkbox" style="margin-right: 8px;">
                                        <span style="font-size: 13px;">ğŸ“¹ æ•™å­¦æ¥¼A-ä¸œé—¨çƒæœº</span>
                                        <span style="margin-left: auto; font-size: 10px; color: #52c41a;">â—åœ¨çº¿</span>
                                    </div>
                                    <div class="device-item"
                                        style="display: flex; align-items: center; padding: 6px 10px; border-bottom: 1px solid #f5f5f5; cursor: pointer;"
                                        onclick="toggleDevice(this, 'æ•™å­¦æ¥¼A-1Fèµ°å»Š')">
                                        <input type="checkbox" style="margin-right: 8px;">
                                        <span style="font-size: 13px;">ğŸ“¹ æ•™å­¦æ¥¼A-1Fèµ°å»Š</span>
                                        <span style="margin-left: auto; font-size: 10px; color: #52c41a;">â—åœ¨çº¿</span>
                                    </div>
                                    <div class="device-item"
                                        style="display: flex; align-items: center; padding: 6px 10px; border-bottom: 1px solid #f5f5f5; cursor: pointer;"
                                        onclick="toggleDevice(this, 'å›¾ä¹¦é¦†-æ­£é—¨')">
                                        <input type="checkbox" style="margin-right: 8px;">
                                        <span style="font-size: 13px;">ğŸ“¹ å›¾ä¹¦é¦†-æ­£é—¨</span>
                                        <span style="margin-left: auto; font-size: 10px; color: #999;">â—ç¦»çº¿</span>
                                    </div>
                                    <div class="device-item"
                                        style="display: flex; align-items: center; padding: 6px 10px; border-bottom: 1px solid #f5f5f5; cursor: pointer;"
                                        onclick="toggleDevice(this, 'å›¾ä¹¦é¦†-é˜…è§ˆå®¤')">
                                        <input type="checkbox" style="margin-right: 8px;">
                                        <span style="font-size: 13px;">ğŸ“¹ å›¾ä¹¦é¦†-é˜…è§ˆå®¤</span>
                                        <span style="margin-left: auto; font-size: 10px; color: #52c41a;">â—åœ¨çº¿</span>
                                    </div>
                                    <div class="device-item"
                                        style="display: flex; align-items: center; padding: 6px 10px; border-bottom: 1px solid #f5f5f5; cursor: pointer;"
                                        onclick="toggleDevice(this, 'è¡Œæ”¿æ¥¼-å¤§å…')">
                                        <input type="checkbox" style="margin-right: 8px;">
                                        <span style="font-size: 13px;">ğŸ“¹ è¡Œæ”¿æ¥¼-å¤§å…</span>
                                        <span style="margin-left: auto; font-size: 10px; color: #52c41a;">â—åœ¨çº¿</span>
                                    </div>
                                </div>
                                <div
                                    style="padding: 6px 8px; border-top: 1px solid #eee; background: #fafafa; font-size: 11px; color: #999; text-align: center;">
                                    å…± 6 å°è®¾å¤‡
                                </div>
                            </div>

                            <!-- Right Panel: Selected Devices -->
                            <div
                                style="flex: 1; background: #fff; border: 1px solid #ddd; border-radius: 6px; display: flex; flex-direction: column;">
                                <div
                                    style="padding: 8px; border-bottom: 1px solid #eee; background: #e6f7ff; border-radius: 6px 6px 0 0; display: flex; justify-content: space-between; align-items: center;">
                                    <span style="font-weight: 500; font-size: 13px;">å·²é€‰è®¾å¤‡ (<span
                                            id="selectedCount">0</span>)</span>
                                    <button type="button" class="btn btn-secondary"
                                        style="font-size: 11px; padding: 2px 8px;"
                                        onclick="clearAllSelected()">æ¸…ç©º</button>
                                </div>
                                <div id="selectedDeviceList"
                                    style="flex: 1; overflow-y: auto; max-height: 220px; padding: 4px 0;">
                                    <div id="emptyHint"
                                        style="text-align: center; padding: 40px 20px; color: #999; font-size: 13px;">
                                        è¯·ä»å·¦ä¾§åˆ—è¡¨é€‰æ‹©è®¾å¤‡
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Tag Select Placeholder -->
                        <div id="tagScope" style="display: none;">
                            <select class="glass-input" style="width: 100%;">
                                <option>è¯·é€‰æ‹©æ ‡ç­¾...</option>
                                <option>è¡Œæ”¿æ¥¼</option>
                                <option>å®¿èˆæ¥¼</option>
                                <option>æ•™å­¦æ¥¼</option>
                            </select>
                            <div style="margin-top: 10px; border-top: 1px dashed #eee; padding-top: 8px;">
                                <label
                                    style="font-size: 12px; color: #666; display: block; margin-bottom: 6px;">æˆæƒæ¨¡å¼</label>
                                <div style="display: flex; gap: 16px;">
                                    <label style="font-size: 13px; display: flex; align-items: center; gap: 4px;">
                                        <input type="radio" name="authMode" value="dynamic" checked> åŠ¨æ€æˆæƒ
                                        <span style="color: #999; font-size: 12px;">(è‡ªåŠ¨æ¶µç›–æ–°å¢)</span>
                                    </label>
                                    <label style="font-size: 13px; display: flex; align-items: center; gap: 4px;">
                                        <input type="radio" name="authMode" value="snapshot"> å¿«ç…§æˆæƒ
                                        <span style="color: #999; font-size: 12px;">(å›ºå®šå½“å‰)</span>
                                    </label>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="input-group">
                        <label class="input-label"><span style="color:red">*</span> ç”³è¯·æœŸé™</label>
                        <div style="display: flex; align-items: center; gap: 8px;">
                            <input type="date" class="glass-input" style="width: 150px;">
                            <span>è‡³</span>
                            <input type="date" class="glass-input" style="width: 150px;">
                            <label style="margin-left: 12px;"><input type="checkbox"> é•¿æœŸæœ‰æ•ˆ</label>
                        </div>
                    </div>

                    <div class="input-group">
                        <label class="input-label"><span style="color:red">*</span> ç”³è¯·ç†ç”±</label>
                        <textarea class="glass-input" rows="3" placeholder="è¯·è¯¦ç»†è¯´æ˜ç”³è¯·ç†ç”± (10-500å­—)"></textarea>
                    </div>

                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeRequestModal()">å–æ¶ˆ</button>
                <button class="btn btn-primary" onclick="submitRequest()">æäº¤</button>
            </div>
        </div>
    </div>

    <!-- Request Detail Modal -->
    <div class="modal-overlay" id="detailModal">
        <div class="modal-content" style="width: 700px;">
            <div class="modal-header">
                <h3 class="modal-title">ç”³è¯·è¯¦æƒ…</h3>
                <button class="modal-close" onclick="closeDetailModal()">Ã—</button>
            </div>
            <div class="modal-body">
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
                    <div class="detail-group">
                        <label class="detail-label">ç”³è¯·å•å·</label>
                        <div class="detail-value">REQ202510250001</div>
                    </div>
                    <div class="detail-group">
                        <label class="detail-label">å½“å‰çŠ¶æ€</label>
                        <div class="detail-value"><span class="status-tag status-warning">å¾…å®¡æ‰¹</span></div>
                    </div>
                    <div class="detail-group">
                        <label class="detail-label">å…³è”åº”ç”¨</label>
                        <div class="detail-value">æ™ºæ…§å®‰é˜²åº”ç”¨</div>
                    </div>
                    <div class="detail-group">
                        <label class="detail-label">ç”³è¯·æ—¶é—´</label>
                        <div class="detail-value">2025-10-25 10:30</div>
                    </div>
                </div>

                <div class="detail-group" style="margin-bottom: 16px;">
                    <label class="detail-label">ç”³è¯·å†…å®¹</label>
                    <div class="detail-value"
                        style="background: #f8fafc; padding: 12px; border-radius: 6px; border: 1px solid #f1f5f9;">
                        <div style="margin-bottom: 8px; display: flex;">
                            <span style="color: #64748b; width: 70px;">ç”³è¯·æœŸé™:</span>
                            <span>2025-10-25 è‡³ é•¿æœŸæœ‰æ•ˆ</span>
                        </div>
                        <div>
                            <div style="color: #64748b; margin-bottom: 4px;">æ•°æ®èŒƒå›´:</div>
                            <ul style="margin: 0; padding-left: 20px; color: #334155; font-size: 13px;">
                                <li>ğŸ“¹ æ•™å­¦æ¥¼A-å¤§å…å…¨æ™¯</li>
                                <li>ğŸ“¹ æ•™å­¦æ¥¼A-ä¸œé—¨çƒæœº</li>
                            </ul>
                        </div>
                    </div>
                </div>

                <div class="detail-group">
                    <label class="detail-label">ç”³è¯·ç†ç”±</label>
                    <div class="detail-value"
                        style="background: #f8fafc; padding: 12px; border-radius: 4px; border: 1px solid #f1f5f9;">
                        å› æ ¡å›­å‘¨ç•Œå®‰é˜²ç›‘æ§é¡¹ç›®éœ€è¦ï¼Œéœ€è·å–ä¸œé—¨åŠå¤§å…æ‘„åƒå¤´çš„é¢„è§ˆåŠå›æ”¾æƒé™ã€‚
                    </div>
                </div>

                <div id="approvalInfo" class="detail-group"
                    style="border-top: 1px dashed #eee; padding-top: 16px; margin-top: 16px; display: none;">
                    <label class="detail-label">å®¡æ‰¹ä¿¡æ¯</label>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-bottom: 8px;">
                        <div><span style="color: #64748b;">å®¡æ ¸äºº:</span> <span id="approverName">-</span></div>
                        <div><span style="color: #64748b;">å®¡æ ¸æ—¶é—´:</span> <span id="approveTime">-</span></div>
                    </div>
                    <div class="detail-value" style="color: #666;">
                        <span style="color: #64748b;">å®¡æ‰¹æ„è§:</span> <span id="approveComment">(æ— )</span>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-primary" onclick="closeDetailModal()">å…³é—­</button>
            </div>
        </div>
    </div>

    <!-- Authorization Modal -->
    <div class="modal-overlay" id="authModal">
        <div class="modal-content" style="width: 700px;">
            <div class="modal-header">
                <h3 class="modal-title">æˆæƒä¿¡æ¯</h3>
                <button class="modal-close" onclick="closeAuthModal()">Ã—</button>
            </div>
            <div class="modal-body">
                <div class="detail-group" style="margin-bottom: 16px;">
                    <label class="detail-label">å·²æˆæƒèŒƒå›´</label>
                    <div class="detail-value"
                        style="background: #f0f9ff; padding: 12px; border-radius: 6px; border: 1px solid #bae6fd;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                            <span style="font-weight: 500; color: #0369a1;">æˆæƒæ¨¡å¼: å¿«ç…§æˆæƒ</span>
                            <span style="font-size: 12px; color: #0284c7;">æœ‰æ•ˆæœŸè‡³: 2026-10-20</span>
                        </div>
                        <div
                            style="max-height: 150px; overflow-y: auto; background: #fff; border: 1px solid #e0f2fe; border-radius: 4px; padding: 8px;">
                            <ul style="margin: 0; padding-left: 20px; color: #334155; font-size: 13px;">
                                <li>ğŸ“¹ æ•™å­¦æ¥¼A-å¤§å…å…¨æ™¯ <span
                                        style="color:#52c41a; font-size: 10px; margin-left: 4px;">â—åœ¨çº¿</span></li>
                                <li>ğŸ“¹ æ•™å­¦æ¥¼A-ä¸œé—¨çƒæœº <span
                                        style="color:#52c41a; font-size: 10px; margin-left: 4px;">â—åœ¨çº¿</span></li>
                                <li>ğŸ“¹ å›¾ä¹¦é¦†-æ­£é—¨ <span style="color:#999; font-size: 10px; margin-left: 4px;">â—ç¦»çº¿</span>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-primary" onclick="closeAuthModal()">å…³é—­</button>
            </div>
        </div>
    </div>


    <script src="script.js"></script>
    <script>
        // Selected devices storage
        let selectedDevices = [];

        function searchData() {
            showToast('æ•°æ®å·²åˆ·æ–°');
        }

        function openRequestModal() {
            document.getElementById('requestModal').classList.add('active');
        }

        function closeRequestModal() {
            document.getElementById('requestModal').classList.remove('active');
        }

        function toggleScope(type) {
            if (type === 'device') {
                document.getElementById('deviceScope').style.display = 'flex';
                document.getElementById('tagScope').style.display = 'none';
            } else {
                document.getElementById('deviceScope').style.display = 'none';
                document.getElementById('tagScope').style.display = 'block';
            }
        }

        function toggleDevice(element, deviceName) {
            const checkbox = element.querySelector('input[type="checkbox"]');
            checkbox.checked = !checkbox.checked;

            if (checkbox.checked) {
                if (!selectedDevices.includes(deviceName)) {
                    selectedDevices.push(deviceName);
                    addToSelectedList(deviceName);
                }
            } else {
                removeFromSelected(deviceName);
            }
            updateSelectedCount();
        }

        function addToSelectedList(deviceName) {
            const list = document.getElementById('selectedDeviceList');
            const emptyHint = document.getElementById('emptyHint');
            if (emptyHint) emptyHint.style.display = 'none';

            const item = document.createElement('div');
            item.className = 'selected-device-item';
            item.setAttribute('data-device', deviceName);
            item.style.cssText = 'display: flex; justify-content: space-between; align-items: center; padding: 6px 10px; border-bottom: 1px solid #f5f5f5;';
            item.innerHTML = `
                    <span style="font-size: 13px;">ğŸ“¹ ${deviceName}</span>
                    <button type="button" class="btn btn-secondary" style="font-size: 10px; padding: 2px 6px; color: var(--danger);" onclick="removeDevice('${deviceName}')">ç§»é™¤</button>
                `;
            list.appendChild(item);
        }

        function removeDevice(deviceName) {
            removeFromSelected(deviceName);
            // Uncheck in left panel
            const deviceItems = document.querySelectorAll('.device-item');
            deviceItems.forEach(item => {
                if (item.getAttribute('onclick').includes(deviceName)) {
                    item.querySelector('input[type="checkbox"]').checked = false;
                }
            });
            updateSelectedCount();
        }

        function removeFromSelected(deviceName) {
            selectedDevices = selectedDevices.filter(d => d !== deviceName);
            const item = document.querySelector(`[data-device="${deviceName}"]`);
            if (item) item.remove();

            if (selectedDevices.length === 0) {
                const emptyHint = document.getElementById('emptyHint');
                if (emptyHint) emptyHint.style.display = 'block';
            }
        }

        function clearAllSelected() {
            selectedDevices = [];
            const list = document.getElementById('selectedDeviceList');
            list.innerHTML = '<div id="emptyHint" style="text-align: center; padding: 40px 20px; color: #999; font-size: 13px;">è¯·ä»å·¦ä¾§åˆ—è¡¨é€‰æ‹©è®¾å¤‡</div>';
            // Uncheck all
            document.querySelectorAll('.device-item input[type="checkbox"]').forEach(cb => cb.checked = false);
            updateSelectedCount();
        }

        function updateSelectedCount() {
            document.getElementById('selectedCount').textContent = selectedDevices.length;
        }

        function toggleSelectAll(checkbox) {
            const deviceItems = document.querySelectorAll('.device-item');
            deviceItems.forEach(item => {
                const cb = item.querySelector('input[type="checkbox"]');
                const deviceName = item.getAttribute('onclick').match(/'([^']+)'/)[1];
                if (checkbox.checked && !cb.checked) {
                    cb.checked = true;
                    if (!selectedDevices.includes(deviceName)) {
                        selectedDevices.push(deviceName);
                        addToSelectedList(deviceName);
                    }
                } else if (!checkbox.checked && cb.checked) {
                    cb.checked = false;
                    removeFromSelected(deviceName);
                }
            });
            updateSelectedCount();
        }

        function filterDevices(keyword) {
            const items = document.querySelectorAll('.device-item');
            items.forEach(item => {
                const text = item.textContent.toLowerCase();
                item.style.display = text.includes(keyword.toLowerCase()) ? 'flex' : 'none';
            });
        }

        function submitRequest() {
            if (selectedDevices.length === 0) {
                showToast('è¯·è‡³å°‘é€‰æ‹©ä¸€å°è®¾å¤‡', 'error');
                return;
            }
            closeRequestModal();
            showToast('ç”³è¯·å•å·²æäº¤ï¼Œç­‰å¾…ç®¡ç†å‘˜å®¡æ‰¹', 'success');
        }

        function viewDetail() {
            // In a real app, this would fetch data based on ID. 
            // For prototype, we toggle visibility of approval info based on status context if needed, 
            // but static content is fine for now as requested.
            // Assuming the first row (Pending) triggers this for demo of "View Detail"
            document.getElementById('approvalInfo').style.display = 'none';
            document.getElementById('detailModal').classList.add('active');
        }

        function closeDetailModal() {
            document.getElementById('detailModal').classList.remove('active');
        }

        function viewAuth() {
            document.getElementById('authModal').classList.add('active');
        }

        function closeAuthModal() {
            document.getElementById('authModal').classList.remove('active');
        }

        function withdrawRequest() {
            showConfirm('ç¡®å®šè¦æ’¤å›è¯¥ç”³è¯·å—ï¼Ÿ', () => {
                showToast('ç”³è¯·å·²æ’¤å›', 'info');
            });
        }

        function reApply() {
            openRequestModal();
            showToast('å·²å¤åˆ¶åŸå•æ®ä¿¡æ¯ï¼Œè¯·ä¿®æ”¹åæäº¤');
        }
    </script>
</body>

</html>